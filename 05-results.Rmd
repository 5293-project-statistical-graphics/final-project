# Results

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.align = "center")
``` 

```{r}
library(ggridges)
library(lubridate)
library(stringi)
library(stopwords)
library(tidyverse)
library(qdapRegex)
```

## Quantity Pattern
We firstly focus on the quantity pattern of these two packages. And then explore some rules for pandemic.
```{r}
commits <- read_csv("resources/data/commits.csv")
issue <- read_csv("resources/data/issues.csv")
pull <- read_csv("resources/data/pull_requests.csv")
```


```{r}

#bar plot 

g1<-commits %>%
  select(date,repo) %>%
  mutate(created_wday=wday(date,label=T)) %>%
  group_by(repo,created_wday) %>%
  count(name="number") %>%
  ggplot(aes(x=created_wday,y=number))+
  geom_col()+
  facet_wrap(~repo)+
    labs(x = "created at (weekday)", y = "number of commits",
       title = "Number of commits created per weekday")
# issue per weekday
g2<-issue %>% 
  select(repo, created_at, author_association) %>%
  mutate(created_wday=wday(created_at, label = TRUE)) %>%
  group_by(repo, author_association, created_wday) %>%
  count(name="number") %>%
  ggplot(aes(x = created_wday, y = number)) +
  geom_col() +
  facet_grid(~repo) +
  labs(x = "created at (weekday)", y = "number of issues",
       title = "Number of issues created per weekday")

# pull per weekday
g3<-pull %>% 
  select(repo, created_at, author_association) %>%
  mutate(created_wday=wday(created_at, label = TRUE)) %>%
  group_by(repo, author_association, created_wday) %>%
  count(name="number") %>%
  ggplot(aes(x = created_wday, y = number)) +
  geom_col() +
  facet_grid(~repo) +
  labs(x = "created at (weekday)", y = "number of pull request",
       title = "Number of pull request created per weekday")

library(gridExtra)
grid.arrange(g2,g3,g1,ncol=2)
```

From the overview, we can find a significant difference in numbers between weekdays and weekend. Users of Github prefer to create pull requests, issues and commits during weekdays rather than weekends. When comparing these two packages, the number of all pull requests, issues and commits are smaller than ggplot2. And there is a great gap for the number of pull requests in these two packages.


```{r}
commits$date<-as.Date(commits$date)
g4<-commits %>%
  select(repo,date) %>%
  mutate(year=year(date)-2000) %>%
  group_by(repo,year) %>%
  count(name="number") %>%
  filter(year!=22) %>%
  ggplot(aes(x=year,y=number))+geom_line()+facet_wrap(~repo)+
  scale_x_continuous(breaks=7:21)+
  labs(x="created at(year)",y="number of commits",title="Number of commits")

# issue per year
g5<-issue %>% 
  select(repo, created_at) %>%
  mutate(created_year=year(created_at) - 2000) %>%
  group_by(repo, created_year) %>%
  count(name = "number") %>%
  filter(created_year != 22)  %>%
  ggplot(aes(x = created_year, y = number)) +
  geom_line() +
  facet_wrap(~repo) +
  scale_x_continuous(breaks = 9:21) +
  labs(x = "created at (year)", y = "number of issues",
       title = "Number of issues")

g6<-pull %>% 
  select(repo, created_at) %>%
  mutate(created_year=year(created_at) - 2000) %>%
  group_by(repo, created_year) %>%
  count(name = "number") %>%
  filter(created_year != 22)  %>%
  ggplot(aes(x = created_year, y = number)) +
  geom_line() +
  facet_wrap(~repo) +
  scale_x_continuous(breaks = 9:21) +
  labs(x = "created at (year)", y = "number of pull",
       title = "Number of pull request")
library(gridExtra)
grid.arrange(g5,g6,g4,ncol=2)
```

The data avalible for plotly is from 2014. For plotly, the number of issues and commits first increases and then has a decreasing trend after 2016. And for number of pull request of plotly, it has a decreasing trend. For ggplot2, the number of issues, pull requests and commits have a fluctuate process. In the first two years, the number of these three parts is increasing and for the last four years, especially after the pandemic, the number of these three parts has a decreasing trend. In particular, the number of commits for ggplot2 has a significant period fluctuation during time. Besides, after 2018, plotly is in the decreasing trend, which is partly due to the pandemic.

```{r}
g7<-issue %>% 
  select(repo, author_association, created_at) %>%
  mutate(created_year=year(created_at) - 2000) %>%
  mutate(author_association=case_when(author_association=="COLLABORATOR"~"MEMBER",
                                      author_association=="CONTRIBUTOR"~"CONTRIBUTOR",
                                      author_association=="MEMBER"~"MEMBER",
                                      author_association=="NONE"~"NONE")) %>%
  group_by(repo, author_association, created_year) %>%
  count(name = "number") %>%
  filter(created_year != 22)  %>%
  ggplot(aes(x = created_year, y = number, color = author_association)) +
  geom_line() +
  facet_wrap(~repo) +
  scale_x_continuous(breaks = 9:21) +
  labs(x = "created at (year)", y = "number of issues",
       title = "Number of issues created")
g8<-pull %>% 
  select(repo, author_association, created_at) %>%
  mutate(created_year=year(created_at) - 2000) %>%
  mutate(author_association=case_when(author_association=="COLLABORATOR"~"MEMBER",
                                      author_association=="CONTRIBUTOR"~"CONTRIBUTOR",
                                      author_association=="MEMBER"~"MEMBER",
                                      author_association=="NONE"~"NONE")) %>%
  group_by(repo, author_association, created_year) %>%
  count(name = "number") %>%
  filter(created_year != 22)  %>%
  ggplot(aes(x = created_year, y = number, color = author_association)) +
  geom_line() +
  facet_wrap(~repo) +
  scale_x_continuous(breaks = 9:21) +
  labs(x = "created at (year)", y = "number of pull requests",
       title = "Number of pull requests created")
grid.arrange(g7,g8,ncol=1)
```

When we look into the author association for pull requests and issues, we can draw more analysis conclusions. Due to the same meaning in the definition of "COLLABORATOR" and "MEMBER" in these two packages, we combine these two classes into "MEMBER". When comparing issues and pull requests, "NONE" have created more issues than any other author associations during time. But for pull requests, "MEMBER" dominates mostly and "NONE" is in the low position in the plot. From 2020, partly due to pandemic, the number for both issues and pull requests, of all author associations, for both packages decreases.


```{r}
g9<-issue %>% 
  select(repo, comments, author_association) %>%
  mutate(author_association=case_when(author_association=="COLLABORATOR"~"MEMBER",
                                      author_association=="CONTRIBUTOR"~"CONTRIBUTOR",
                                      author_association=="MEMBER"~"MEMBER",
                                      author_association=="NONE"~"NONE"))%>%
  filter(comments < 15) %>%
  ggplot(aes(x = comments, y = repo, fill = stat(quantile))) +
  stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, bandwidth = 1,
                      geom = "density_ridges_gradient") +
  facet_wrap(~author_association) +
  scale_fill_brewer(name = "quantile", labels = c("1st", "2nd", "3rd", "4th")) + 
  theme_ridges()

g10<-pull %>% 
  select(repo, comments, author_association) %>%
  mutate(author_association=case_when(author_association=="COLLABORATOR"~"MEMBER",
                                      author_association=="CONTRIBUTOR"~"CONTRIBUTOR",
                                      author_association=="MEMBER"~"MEMBER",
                                      author_association=="NONE"~"NONE"))%>%
  filter(comments < 15) %>%
  ggplot(aes(x = comments, y = repo, fill = stat(quantile))) +
  stat_density_ridges(quantile_lines = FALSE, calc_ecdf = TRUE, bandwidth = 1,
                      geom = "density_ridges_gradient") +
  facet_wrap(~author_association) +
  scale_fill_brewer(name = "quantile", labels = c("1st", "2nd", "3rd", "4th")) + 
  theme_ridges()

grid.arrange(g9,g10,ncol=1)
```

Both packages have similar distribution shape for all author associations and they all have long right tail. And there is a small peak for comments equal to 10 for plotly. Comparing two packages, ggplot2 is more likely to have a heavy tail.

